const semver = require("semver");
const vulnerabilityDB = require("../data/vulnerabilityDB");


function findVulnerabilities(packageName, installedVersion){
    const records = vulnerabilityDB[packageName];

    if(!records)  return [];
    const resolvedVersion = semver.minVersion(installedVersion);
    if (!resolvedVersion)   return [];

    return records.filter(vuln => 
        // cve: vuln.cve,
        // severity: vuln.severity,
        // description: vuln.description,
        // fixedIn: vuln.fixedIn,
        // currentVersion: version
        semver.satisfies(resolvedVersion.version, vuln.affectedVersions)
    );
}


module.exports = {
    findVulnerabilities
};